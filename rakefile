load '../z80-libraries/tasks.rake'

namespace 'build' do
    desc "Build boot sector image"
    task 'boot' do
        cmd = "zcc "
        cmd += "+#{CONFIG} -compiler-sccz80 "
        cmd += "-O2 -SO2 "
        cmd += "-L#{LIB} -I#{LIB_INCLUDE} "
        cmd += "-Ca\"-I#{LIB_INCLUDE}\" "
        cmd += "--no-crt "
        cmd += "-o bootsector.bin "
        cmd += "boot/bootsector.asm"

        success = system(cmd)

        if success
            system("z88dk-dis -o 0x8000 bootsector.bin > bootsector.diss")
        end
    end
end
